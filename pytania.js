const quizData = [
    {
        question: "Jaka jest największa rzeka w Polsce?",
        answers: {
            a: "Wisła",
            b: "Odra",
            c: "Warta",
			d: "Bug"
        },
        correctAnswer: "a"
    },
    {
        question: "Które miasto jest stolicą kulturalną Polski?",
        answers: {
            a: "Kraków",
            b: "Gdańsk",
            c: "Wrocław",
			d: "Poznań"
        },
        correctAnswer: "a"
    },
	{
        question: "Jakie morze leży na północ od Polski?",
        answers: {
            a: "Bałtyk",
            b: "Czarne",
            c: "Adriatyk",
			d: "Północne"
        },
        correctAnswer: "a"
    },
	{
        question: "Który polski wynalazek zdobył nagrodę Nobla?",
        answers: {
            a: "Telefon",
            b: "Samochód",
            c: "Telewizja",
			d: "Penicylina"
        },
        correctAnswer: "d"
    },
	{
        question: "Gdzie znajduje się polski słynny zamek krzyżacki?",
        answers: {
            a: "Malbork",
            b: "Kraków",
            c: "Warszawa",
			d: "Gdańsk"
        },
        correctAnswer: "a"
    },
	{
        question: "Jakie są tradycyjne polskie dania?",
        answers: {
            a: "Sushi i tempura",
            b: "Pizza i makaron",
            c: "Pierogi i gołąbki",
			d: "Tacos i enchiladas"
        },
        correctAnswer: "c"
    },
	{
        question: "Który polski naukowiec był laureatem Nagrody Nobla w dziedzinie fizyki?",
        answers: {
            a: "Maria Skłodowska-Curie",
            b: "Jan Śniadecki",
            c: "Nicolaus Copernicus",
			d: "Ignacy Paderewski"
        },
        correctAnswer: "a"
    },
	{
        question: "Co to jest Solidarność?",
        answers: {
            a: "Polska partia polityczna",
            b: "Ruch oporu podczas II wojny światowej",
            c: "Związek zawodowy",
			d: "Wyspa na Bałtyku"
        },
        correctAnswer: "c"
    },
	{
        question: "Które polskie miasto jest znane z bogatej historii górniczej i kopalni soli?",
        answers: {
            a: "Zakopane",
            b: "Gdańsk",
            c: "Szczecin",
			d: "Wieliczka"
        },
        correctAnswer: "d"
    },
	{
        question: "Jaki jest tradycyjny polski taniec w parze?",
        answers: {
            a: "Salsa",
            b: "Walc wiedeński",
            c: "Polonez",
			d: "Tango"
        },
        correctAnswer: "c"
    },
	{
        question: "Kto jest autorem epopei Pan Tadeusz?",
        answers: {
            a: "Czesław Miłosz",
            b: "Adam Mickiewicz",
            c: "Wisława Szymborska",
			d: "Julian Tuwim"
        },
        correctAnswer: "b"
    },
	{
        question: "Gdzie znajduje się polskie wybrzeże morskie?",
        answers: {
            a: "Na Morzu Czarnym",
            b: "Na Morzu Adriatyckim",
            c: "Na Morzu Bałtyckim",
			d: "Na Morzu Śródziemnym"
        },
        correctAnswer: "c"
    },
	{
        question: "Który polski aktor zdobył Oscara za rolę w Człowieku z marmuru?",
        answers: {
            a: "Jerzy Stuhr",
            b: "Daniel Olbrychski",
            c: "Andrzej Seweryn",
			d: "Zbigniew Zapasiewicz"
        },
        correctAnswer: "c"
    },
	{
        question: "Jak nazywa się polskie danie ziemniaczane w formie krokietów?",
        answers: {
            a: "Placki ziemniaczane",
            b: "Kopytka",
            c: "Krokiety",
			d: "Pyzy"
        },
        correctAnswer: "c"
    },
	{
        question: "Który król panował w Polsce najdłużej?",
        answers: {
            a: "Zygmunt III Waza",
            b: "Kazimierz III Wielki",
            c: "Stanisław August Poniatowski",
			d: "Bolesław Chrobry"
        },
        correctAnswer: "c"
    },
    {
        question: "Gdzie znajduje się słynna świątynia Jasnogórska?",
        answers: {
            a: "W Warszawie",
            b: "W Krakowie",
            c: "W Częstochowie",
			d: "W Gdańsku"
        },
        correctAnswer: "c"
    },
	{
        question: "Kto był pierwszym prezydentem wybranym w wolnych wyborach po upadku komunizmu?",
        answers: {
            a: "Lech Wałęsa",
            b: "Aleksander Kwaśniewski",
            c: "Bronisław Komorowski",
			d: "Andrzej Duda"
        },
        correctAnswer: "a"
    },
	{
        question: "Co to jest pierogi?",
        answers: {
            a: "Polskie słodycze",
            b: "Mięsne danie jednogarnkowe",
            c: "Kuchnia regionalna",
			d: "Naleśniki z nadzieniem"
        },
        correctAnswer: "d"
    },
	{
        question: "Jak nazywa się najwyższy szczyt w Tatrach Polskich?",
        answers: {
            a: "Giewont",
            b: "Kasprowy Wierch",
            c: "Rysy",
			d: "Świnica"
        },
        correctAnswer: "c"
    },
	{
        question: "Które polskie miasto jest znane z dorocznego festiwalu filmowego o nazwie Kino Polska?",
        answers: {
            a: "Kraków",
            b: "Warszawa",
            c: "Gdańsk",
			d: "Gdynia"
        },
        correctAnswer: "d"
    },
	{
        question: "Jakie województwo w Polsce jest największe?",
        answers: {
            a: "wielkopolskie",
            b: "pomorskie",
            c: "mazowieckie",
			d: "warmińsko-mazurskie"
        },
        correctAnswer: "d"
    },
	{
        question: "Jakie województwo w Polsce jest najmniejsze?",
        answers: {
            a: "śląskie",
            b: "opolskie",
            c: "lubelskie",
			d: "lubuskie"
        },
        correctAnswer: "a"
    },
	{
        question: "W jakim mieście znajduje się Zamek Królewski na Wawelu?",
        answers: {
            a: "Kraków",
            b: "Zakopane",
            c: "Ujście Solne",
			d: "Wieliczka"
        },
        correctAnswer: "a"
    },
	{
        question: "Jaka jest największa dzielnica Warszawy?",
        answers: {
            a: "wola",
            b: "mokotów",
            c: "białołęka",
			d: "ursynów"
        },
        correctAnswer: "c"
    },
];

const quizForm = document.getElementById("quizForm");
const quizContainer = document.getElementById("quiz-container");
const startButton = document.querySelector("form button");
const endQuizButton = document.getElementById("endQuizButton");
const resultParagraph = document.getElementById("result");

let questionsLimit;
let score = 0;
let quizCompleted = false;
let shuffledQuizData = [];
let userAnswers = []; // Tablica do przechowywania odpowiedzi użytkownika
let shuffledQuestions = [];

function startQuiz(event) {
    event.preventDefault();

    questionsLimit = parseInt(document.getElementById("questionCount").value);
    if (questionsLimit >= 1) {
        quizForm.style.display = "none";
        quizContainer.style.display = "block";

        shuffledQuizData = shuffleArray(quizData);

        let quizHTML = "";

        for (let i = 0; i < questionsLimit; i++) {
            const questionData = shuffledQuizData[i];
            const answers = questionData.answers;

            quizHTML += `
                <div>
                    <p>${questionData.question}</p>
                    <ul>
                        <li><label><input type="radio" name="q${i}" value="a"> ${answers.a}</label></li>
                        <li><label><input type="radio" name="q${i}" value="b"> ${answers.b}</label></li>
                        <li><label><input type="radio" name="q${i}" value="c"> ${answers.c}</label></li>
						<li><label><input type="radio" name="q${i}" value="d"> ${answers.d}</label></li>
                    </ul>
                </div>
            `;
        }

        quizContainer.innerHTML = quizHTML;
        endQuizButton.style.display = "block";
    } else {
        alert("Podaj poprawną liczbę pytań (minimum 1).");
    }
}


function calculateScore() {
    for (let i = 0; i < questionsLimit; i++) {
        const selectedAnswer = document.querySelector(`input[name="q${i}"]:checked`);
        if (selectedAnswer) {
            const questionData = shuffledQuizData[i];
            const selectedValue = selectedAnswer.value;

            if (selectedValue === questionData.correctAnswer) {
                score++;
            }

            const userAnswer = { question: questionData.question, userChoice: selectedValue, correctAnswer: questionData.correctAnswer };
            userAnswers.push(userAnswer); // Zapisujemy odpowiedź użytkownika
        }
    }
}

function submitQuiz() {
    if (!quizCompleted) {
        calculateScore();
        endQuizButton.disabled = true;
        quizCompleted = true;
        displayResult();
        saveUserAnswersToFile();
    }
}

function displayResult() {
    resultParagraph.innerText = `Twój wynik: ${score}/${questionsLimit}`;
    resultParagraph.style.display = "block";
}

function saveUserAnswersToFile() {
    let userAnswersText = ""; // Tekst do zapisania odpowiedzi użytkownika

    userAnswers.forEach((answer, index) => {
        userAnswersText += `Pytanie ${index + 1}: ${answer.question}\n`;
        userAnswersText += `Odpowiedź użytkownika: ${answer.userChoice}\n`;
        userAnswersText += `Poprawna odpowiedź: ${answer.correctAnswer}\n\n`;
    });

    // Dodajemy sumę punktów do pliku
    userAnswersText += `Suma punktów: ${score}/${questionsLimit}`;

    const blob = new Blob([userAnswersText], { type: "text/plain;charset=utf-8" });
    const filename = "user_answers.txt";

    if (navigator.msSaveBlob) {
        // Dla przeglądarki Internet Explorer/Edge
        navigator.msSaveBlob(blob, filename);
    } else {
        // Dla innych przeglądarek
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.style.display = "none";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
}

function shuffleArray(array) {
    const shuffledArray = array.slice();
    for (let i = shuffledArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]];
    }
    return shuffledArray;
}